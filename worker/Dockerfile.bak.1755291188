FROM python:3.11-slim

# Bezpieczne, małe base + binarki potrzebne w runtime
RUN apt-get update && DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends \
      ffmpeg \
      aubio-tools \
      libsndfile1 \
      libgomp1 \
      libstdc++6 \
      ca-certificates \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app
ENV PYTHONDONTWRITEBYTECODE=1 PYTHONUNBUFFERED=1 PIP_ROOT_USER_ACTION=ignore

# Zależności Pythona (w tym aubio dla Pythona)
COPY worker/requirements.txt /app/requirements.txt
RUN python -m pip install --upgrade pip && pip install -r /app/requirements.txt

# Kod
COPY worker/ /app/

# Domyślny CMD neutralny; właściwy command idzie z compose
CMD ["sleep","infinity"]
